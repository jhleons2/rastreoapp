# üß™ Gu√≠a Completa de Prueba del Sistema

**Sistema de Rastreo Geogr√°fico - Prueba End-to-End**

---

## üìã √çndice

1. [Prerequisitos](#prerequisitos)
2. [Compilar APK para Android](#compilar-apk)
3. [Probar Backend](#probar-backend)
4. [Probar Frontend Web](#probar-frontend)
5. [Probar App M√≥vil](#probar-app)
6. [Prueba Completa del Seguimiento](#prueba-seguimiento)
7. [Troubleshooting](#troubleshooting)

---

## 1Ô∏è‚É£ Prerequisitos

### Software Necesario

- **Android Studio** (descargar desde: https://developer.android.com/studio)
- **Node.js** v16+ (ya lo tienes)
- **npm** o **yarn**
- **Git** (ya lo tienes)
- **Un tel√©fono Android** (m√≠nimo Android 6.0)

### Cuentas y URLs

- **Backend:** https://rastreoapp-production.up.railway.app
- **Frontend:** https://rastreoapp-frontend-production.up.railway.app
- **Repositorio:** https://github.com/jhleons2/rastreoapp

---

## 2Ô∏è‚É£ Compilar APK para Android

### Opci√≥n A: Compilar APK (Para Instalar en Celular) ‚≠ê RECOMENDADO

#### Paso 1: Configurar Android Studio

```bash
# Descargar e instalar Android Studio desde:
https://developer.android.com/studio

# Durante la instalaci√≥n, instalar:
- Android SDK
- Android SDK Platform
- Android Virtual Device (AVD)
```

#### Paso 2: Configurar Variables de Entorno

**Windows (PowerShell):**
```powershell
# Agregar al PATH (en Variables de Entorno del Sistema):
$env:ANDROID_HOME = "C:\Users\$env:USERNAME\AppData\Local\Android\Sdk"
$env:Path += ";$env:ANDROID_HOME\platform-tools"
$env:Path += ";$env:ANDROID_HOME\tools"
$env:Path += ";$env:ANDROID_HOME\tools\bin"
```

**Verificar instalaci√≥n:**
```bash
adb version  # Deber√≠a mostrar versi√≥n de adb
```

#### Paso 3: Instalar Dependencias del Proyecto

```bash
cd mobile
npm install
```

#### Paso 4: Configurar Android en el Proyecto

```bash
cd android
# Aseg√∫rate de estar en la carpeta mobile/android

# Verificar que gradlew existe
dir gradlew  # Windows
```

Si no existe el archivo `gradlew`, necesitas crear el proyecto de cero:

```bash
# Volver a la ra√≠z del proyecto mobile
cd ..
npx react-native init RastreoAppTemp --version 0.72.0
# Copiar archivos a RastreoAppTemp
# Luego renombrar
```

#### Paso 5: Compilar APK

```bash
# Desde mobile/android
cd android

# Compilar APK de debug (m√°s r√°pido, para pruebas)
./gradlew assembleDebug
# En Windows, usa:
gradlew.bat assembleDebug
```

La APK estar√° en:
```
mobile/android/app/build/outputs/apk/debug/app-debug.apk
```

#### Paso 6: Instalar APK en el Celular

**Opci√≥n 1: Por USB**
```bash
# Conectar celular por USB y activar "Depuraci√≥n USB" en opciones de desarrollador
adb install app/build/outputs/apk/debug/app-debug.apk
```

**Opci√≥n 2: Compartir Archivo**
- Copiar `app-debug.apk` al celular
- Abrir el archivo en el celular
- Permitir "Instalar desde fuentes desconocidas"

---

### Opci√≥n B: Usar Expo Go (M√°s F√°cil para Pruebas R√°pidas)

Si compilar la APK es complicado, puedes usar Expo:

```bash
cd mobile

# Instalar Expo CLI
npm install -g expo-cli

# Iniciar servidor
npx expo start
```

Esto generar√° un c√≥digo QR que escaneas con la app **Expo Go** (descargar desde Play Store).

---

## 3Ô∏è‚É£ Probar Backend

### 3.1 Health Check

```bash
curl https://rastreoapp-production.up.railway.app/health
```

**Respuesta esperada:**
```json
{
  "status": "OK",
  "timestamp": "2024-01-XX",
  "database": "connected"
}
```

### 3.2 Crear Usuario de Prueba

```bash
curl -X POST https://rastreoapp-production.up.railway.app/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "phone_number": "+573001234567",
    "email": "prueba@test.com",
    "password": "test123"
  }'
```

**Respuesta esperada:**
```json
{
  "message": "Usuario registrado exitosamente",
  "userId": 1
}
```

### 3.3 Login

```bash
curl -X POST https://rastreoapp-production.up.railway.app/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "phone_number": "+573001234567",
    "password": "test123"
  }'
```

**Respuesta esperada:**
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": { "id": 1, "phone_number": "+573001234567", ... }
}
```

### 3.4 Crear Dispositivo

```bash
# Usa el token del login anterior
TOKEN="eyJhbGciOiÂèàÂ¶ÇI1NiIsInR5cCI6IkpXVCJ9..."

curl -X POST https://rastreoapp-production.up.railway.app/api/devices \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "device_name": "Celular de Prueba",
    "device_type": "Android",
    "is_active": true
  }'
```

### 3.5 Enviar Ubicaci√≥n

```bash
curl -X POST https://rastreoapp-production.up.railway.app/api/locations \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{
    "device_id": 1,
    "latitude": 4.6097,
    "longitude": -74.0817,
    "accuracy": 10,
    "altitude": 2640,
    "speed": 0,
    "heading": 0
  }'
```

---

## 4Ô∏è‚É£ Probar Frontend Web

### 4.1 Abrir Dashboard

Abre en el navegador:
```
https://rastreoapp-frontend-production.up.railway.app
```

### 4.2 Registrar Usuario en el Dashboard

1. Click en "Registrarse"
2. Ingresa datos:
   - Tel√©fono: +573001234567
   - Email: prueba@test.com
   - Contrase√±a: test123
3. Click "Crear Cuenta"

### 4.3 Iniciar Sesi√≥n

1. Ingresa tel√©fono y contrase√±a
2. Click "Iniciar Sesi√≥n Presenta el Dashboard

### 4.4 Crear Dispositivo desde Dashboard

1. Ve a la pesta√±a "Dispositivos"
2. Click "Agregar Dispositivo"
3. Ingresa:
   - Nombre: Celular de Prueba
   - Tipo: Android
   - Estado: Activo
4. Click "Guardar"

### 4.5 Ver Mapa de Ubicaciones

1. Ve a la pesta√±a "Ubicaciones"
2. Selecciona el dispositivo
3. Ver√°s el mapa con ubicaciones (si hay)

---

## 5Ô∏è‚É£ Probar App M√≥vil

### 5.1 Instalar App

**M√©todo 1: APK compilada**
- Instalar `app-debug.apk` en el celular

**M√©todo 2: Expo Go**
- Escanear QR con Expo Go

### 5.2 Flujo de Prueba en la App

#### Paso 1: Abrir App
- Abre la app "RastreoApp" en tu celular

#### Paso 2: Registrar Usuario
1. Click en "Reg√≠strate"
2. Ingresa:
   - Tel√©fono: +573001234567 (usa tu n√∫mero real)
   - Email: prueba@test.com
   - Contrase√±a: test123
3. Click "Crear Cuenta"

#### Paso 3: Iniciar Sesi√≥n
1. Ingresa tu n√∫mero de tel√©fono
2. Ingresa contrase√±a
3. Click "Iniciar Sesi√≥n"

#### Paso 4: Aceptar Permisos
1. La app solicitar√° permisos de ubicaci√≥n
2. Click "Permitir" o "Aceptar"
3. Si aparece una segunda solicitud (para usar ubicaci√≥n en segundo plano), tambi√©n acepta

#### Paso 5: Iniciar Rastreo
1. Click en el bot√≥n "INICIAR RASTREO"
2. El estado cambiar√° a "RASTREO ACTIVO"
3. Ver√°s tu ubicaci√≥n en pantalla

#### Paso 6: Verificar que Env√≠a Datos
1. Espera 10 minutos (o modifica el intervalo en el c√≥digo)
2. Verifica los logs en la pantalla de la app
3. Deber√≠as ver mensajes como:
   - "Ubicaci√≥n enviada correctamente"
   - "Coordenadas: lat, lon"

---

## 6Ô∏è‚É£ Prueba Completa del Seguimiento

### Escenario de Prueba Completo

Este escenario prueba todo el flujo end-to-end:

#### Parte 1: Preparaci√≥n (5 min)

1. **Backend funcionando:**
   ```bash
   curl https://rastreoapp-production.up.railway.app/health
   ```
   ‚úÖ Debe responder OK

2. **Frontend funcionando:**
   - Abre: https://rastreoapp-frontend-production.up.railway.app
   ‚úÖ Debe cargar el login

3. **App instalada en celular:**
   ‚úÖ APK instalada o Expo Go conectado

#### Parte 2: Usuario Nuevo (5 min)

1. **Crear cuenta en la App:**
   - Tel√©fono: +573001234567
   - Email: prueba@app.com
   - Contrase√±a: test123
   ‚úÖ Usuario creado

2. **Iniciar sesi√≥n en la App:**
   ‚úÖ Login exitoso

3. **Verificar en Backend:**
   ```bash
   curl -X GET https://rastreoapp-production.up.railway.app/api/users/1 \
     -H "Authorization: Bearer $TOKEN"
   ```
   ‚úÖ Debe devolver el usuario creado

#### Parte 3: Rastreo B√°sico (10 min)

1. **Iniciar rastreo en App:**
   - Click "INICIAR RASTREO"
   - Aceptar permisos
   ‚úÖ Estado: "RASTREO ACTIVO"

2. **Esperar primera ubicaci√≥n (10 segundos):**
   - App debe mostrar: "Ubicaci√≥n: lat, lon"
   ‚úÖ Ubicaci√≥n capturada

3. **Verificar en Backend:**
   ```bash
   curl -X GET https://rastreoapp-production.up.railway.app/api/locations \
     -H "Authorization: Bearer $TOKEN"
   ```
   ‚úÖ Debe devolver array con 1 ubicaci√≥n

4. **Ver en Dashboard Web:**
   - Inicia sesi√≥n en el dashboard
   - Ve a "Ubicaciones"
   - Selecciona el dispositivo
   - Ver√°s el mapa con un marcador
   ‚úÖ Ubicaci√≥n en mapa

#### Parte 4: Rastreo Prolongado (15 min)

1. **Dejar app activa:**
   - Mant√©n la app abierta
   - Camina o mueve el celular

2. **Cada 10 minutos:**
   - La app enviar√° una nueva ubicaci√≥n
   - Ver√°s el mensaje "Ubicaci√≥n enviada" en la app

3. **Verificar acumulaci√≥n:**
   ```bash
   curl -X GET https://rastreoapp-production.up.railway.app/api/locations/device/1 \
     -H "Authorization: Bearer $TOKEN"
   ```
   ‚úÖ Debe devolver varias ubicaciones

4. **Ver en Dashboard:**
   - Actualiza la p√°gina de Locations
   - Deber√≠as ver varios marcadores en el mapa
   - Deber√≠as ver una l√≠nea que conecta las ubicaciones
   ‚úÖ Ruta visible en mapa

#### Parte 5: M√∫ltiples Dispositivos (Opcional - 10 min)

1. **Crear segundo dispositivo en Dashboard:**
   - Ve a "Dispositivos"
   - Click "Agregar Dispositivo"
   - Nombre: Tableta de Casa
   - Tipo: Android

2. **Desde otro celular/emulador:**
   - Abre la app
   - Inicia sesi√≥n con la MISMA cuenta
   - Se crear√° autom√°ticamente otro dispositivo

3. **Rastrear ambos:**
   - Inicia rastreo en ambos dispositivos
   - Moverse en diferentes ubicaciones

4. **Ver en Dashboard:**
   - Selecciona cada dispositivo
   - Ver√°s ubicaciones diferentes en cada uno
   ‚úÖ M√∫ltiples dispositivos rastreando

---

## 7Ô∏è‚É£ Checklist de Prueba

### Backend ‚úÖ
- [ ] Health check responde OK
- [ ] Registro de usuario funciona
- [ ] Login devuelve token JWT
- [ ] Crear dispositivo funciona
- [ ] Enviar ubicaci√≥n funciona
- [ ] Obtener ubicaciones devuelve datos

### Frontend ‚úÖ
- [ ] Dashboard carga correctamente
- [ ] Login funciona
- [ ] Registro funciona
- [ ] Gr√°ficos muestran datos
- [ ] Gesti√≥n de dispositivos funciona
- [ ] Mapa carga y muestra ubicaciones

### App M√≥vil ‚úÖ
- [ ] App se instala correctamente
- [ ] Login funciona
- [ ] Registro funciona
- [ ] Permisos se solicitan
- [ ] Permisos se otorgan
- [ ] Rastreo se inicia
- [ ] Ubicaci√≥n se captura
- [ ] Ubicaci√≥n se env√≠a al backend
- [ ] M√∫ltiples ubicaciones se env√≠an

### Integraci√≥n ‚úÖ
- [ ] Usuario creado en app aparece en backend
- [ ] Ubicaciones de app aparecen en backend
- [ ] Ubicaciones de app aparecen en dashboard
- [ ] Mapa muestra ubicaciones correctas
- [Ê∏ØÊæ≥] Gr√°ficos actualizan con nuevos datos

---

## 8Ô∏è‚É£ Troubleshooting

### Error: "Cannot connect to backend"

**Causa:** La URL del backend en la app est√° incorrecta.

**Soluci√≥n:**
1. Editar `mobile/src/config/api.js`
2. Verificar que la URL sea: `https://rastreoapp-production.up.railway.app/api`

### Error: "Permission denied" en GPS

**Causa:** Permisos no otorgados correctamente.

**Soluci√≥n:**
1. Android: Settings > Apps > RastreoApp > Permissions > Location > Allow all the time
2. Verificar `AndroidManifest.xml` tiene los permisos
3. Reinstalar la app

### Error: "Unable to load script"

**Causa:** Metro bundler no est√° corriendo.

**Soluci√≥n:**
```bash
cd mobile
npm start -- --reset-cache
```

### Error: "Apk not found"

**Causa:** La APK no se compil√≥.

**Soluci√≥n:**
```bash
cd mobile/android
gradlew.bat assembleDebug
# Windows
```

### La ubicaci√≥n no se env√≠a

**Causa:** Token JWT expirado o incorrecto.

**Soluci√≥n:**
1. Cerrar sesi√≥n en la app
2. Volver a iniciar sesi√≥n
3. Iniciar rastreo nuevamente

### El mapa no muestra ubicaciones

**Causa:** Leaflet no carga o no hay datos.

**Soluci√≥n:**
1. Verificar que el backend tiene ubicaciones: `GET /api/locations`
2. Verificar la consola del navegador por errores
3. Verificar que Leaflet CSS est√° cargado

---

## üìä Resultados Esperados

### Despu√©s de una Prueba Completa Exitosa:

‚úÖ **Backend:**
- 1 usuario creado
- 1 o m√°s dispositivos creados
- 5-10 ubicaciones almacenadas
- Todas las ubicaciones con lat/lon v√°lidos

‚úÖ **Frontend:**
- Dashboard muestra estad√≠sticas correctas
- Gr√°fico muestra dispositivos activos/inactivos
- Lista de dispositivos funciona
- Mapa muestra marcadores y ruta

‚úÖ **App M√≥vil:**
- Usuario autenticado correctamente
- Permisos de ubicaci√≥n otorgados
- Rastreo activo
- Ubicaciones envi√°ndose cada 10 minutos

---

## üéØ Demo para Presentaci√≥n

### Script de Demo (15 minutos)

1. **Intro (2 min)**
   - Mostrar diagrama del sistema
   - Explicar arquitectura

2. **Backend (3 min)**
   - Mostrar health check
   - Hacer curl de registro
   - Hacer curl de creaci√≥n de dispositivo

3. **Frontend (3 min)**
   - Mostrar dashboard con estad√≠sticas
   - Crear dispositivo desde el dashboard
   - Mostrar gr√°ficos

4. **App M√≥vil (7 min)** ‚≠ê
   - Mostrar app instalada en celular
   - Mostrar registro con n√∫mero de tel√©fono
   - Solicitar permisos GPS
   - Iniciar rastreo
   - Mostrar que se env√≠a ubicaci√≥n
   - Esperar 1-2 minutos
   - Mostrar en dashboard web que apareci√≥ la ubicaci√≥n
   - Mostrar mapa con ubicaciones

---

## üéâ ¬°Listo para Probar!

Sigue esta gu√≠a paso a paso y tendr√°s un sistema completamente funcional para demostrar.

**Preguntas frecuentes:**

**Q: ¬øNecesito compilar la APK o puedo usar Expo?**  
A: Para una demo funcional completa, usa la APK compilada. Para pruebas r√°pidas, Expo es m√°s f√°cil.

**Q: ¬øCu√°nto tiempo tarda en enviar la primera ubicaci√≥n?**  
A: Inmediatamente despu√©s de iniciar el rastreo (el intervalo de 10 minutos es para ubicaciones posteriores).

**Q: ¬øPuedo cambiar el intervalo de env√≠o?**  
A: S√≠, edita `LocationService.js` y cambia el valor de `interval`.

---

**¬°√âxito con la prueba del sistema!** üöÄ

